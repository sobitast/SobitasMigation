<app-breadcrumbs [page]="product?.designation_fr"></app-breadcrumbs>

<style>
  .pm {
    width: 35px !important;
    max-width: 35px !important;
    min-width: 34px !important;
    border-radius: 5px;
    color: #fff
  }
</style>
<div class="product_page_bg">
  <div class="container" *ngIf="product">
    <!--product details start-->
    <div class="product_details">
      <div class="row">
        <div class="col-lg-4 col-md-4 col-sm-12">
          <div class="product-details-tab">
            <div id="img-1" class="zoomWrapper single-zoom" style="min-height: 400px;">
              <a style="position: relative;" href="#">
                <img id="zoom1" [src]="
                    product.cover
                      ? storage + product.cover
                      : 'assets/img/product/p1.webp'
                  " [attr.data-zoom-image]="product.cover
                  ? storage + product.cover
                  : 'assets/img/product/p1.webp'" [style.opacity]="product.rupture == 0 ? 0.5 : 1" loading="eager"
                  fetchpriority="auto" [alt]="product.alt_cover ? product.alt_cover : product.designation_fr"
                  [title]="product.description_cover ? product.description_cover : product.designation_fr" />
                <div class="sign" *ngIf="product.rupture == 0">
                  Rupture De Stock
                </div>
              </a>
            </div>
            <div class="single-zoom-thumb">
              <ul class="s-tab-zoom owl-carousel single-product-active" id="gallery_01">
                <li *ngFor="let photo of gallery; let i = index">
                  <a href="#" class="elevatezoom-gallery active" data-update=""
                    [attr.data-image]="storage + photo.download_link"
                    [attr.data-zoom-image]="storage + photo.download_link">
                    <img [src]="storage + photo.download_link" fetchpriority="auto"
                      [alt]="product.alt_cover ? product.alt_cover : product.designation_fr"
                      [title]="product.description_cover ? product.description_cover : product.designation_fr" />
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-lg-8 col-md-8 col-sm-12">
          <div class="product_d_right">
            <h1 style="font-size: 22px;">
              <a href="#">{{ product.designation_fr }}</a>
            </h1>

            <div class="product_rating">
              <ul>
                <li>
                  <i class="{{
                        product.note && product.note >= 1
                        ? 'fa-solid fa-star'
                        : 'fa-regular fa-star'
                      }}"></i>
                </li>
                <li>
                  <i class="{{
                        product.note && product.note >= 2
                        ? 'fa-solid fa-star'
                        : 'fa-regular fa-star'
                      }}"></i>
                </li>
                <li>
                  <i class="{{
                        product.note && product.note >= 3
                        ? 'fa-solid fa-star'
                        : 'fa-regular fa-star'
                      }}"></i>
                </li>
                <li>
                  <i class="{{
                        product.note && product.note >= 4
                        ? 'fa-solid fa-star'
                        : 'fa-regular fa-star'
                      }}"></i>
                </li>
                <li>
                  <i class="{{
                        product.note && product.note >= 5
                        ? 'fa-solid fa-star'
                        : 'fa-regular fa-star'
                      }}"></i>
                </li>
              </ul>
            </div>
            <div class="price_box">
              <span class="old_price" *ngIf="product.promo">
                {{ product.prix }} DT</span>
              <span class="current_price">{{ product.promo ? product.promo : product.prix }} DT</span>
            </div>
            <div class="product_desc desc">
              <p [innerHTML]="product.meta_description_fr"></p>
            </div>
            <div class="product_variant color" *ngIf="product.aromes.length > 0">
              <h3>Arômes</h3>
              <select class="select_option form-control" style="width: 30%; margin-top: 5px">
                <option *ngFor="let arome of product.aromes" selected [value]="arome.id">
                  {{ arome.designation_fr }}
                </option>
              </select>
            </div>
            <div class="product_variant quantity" *ngIf="product.rupture != 0">
              <label>Quantité</label>
              <button (click)="inc_dec_qte('dec' )" [disabled]="product.quantity<=1" class="pm">-</button>
              <input min="1" max="100" [(ngModel)]="quantity" title="Quantity" type="number"
                style="text-align: center;">
              <button (click)="inc_dec_qte('inc' )" class="pm">+</button>
              <button class="button" type="submit" (click)="addToCard()">
                Ajouter au panier
              </button>
            </div>

            <div class="product_meta">
              <span>Categories:
                <a *ngIf="product.sous_categorie" [routerLink]="[
                    '/category',
                    product.sous_categorie?.slug
                  ]">{{ product.sous_categorie?.designation_fr }} ,</a>
                <a *ngIf="product.sous_categorie && product.sous_categorie" [routerLink]="[
                    '/categorie',
                    product.sous_categorie.categorie?.slug
                  ]">{{ product.sous_categorie?.categorie?.designation_fr }}</a></span>
            </div>
            <div>
              <div><app-social-share [description]="product.designation_fr"></app-social-share></div>
            </div>
            <div class="product_meta" *ngIf="product.tags && product.tags.length > 0">
              <span>Mots clés:
                <span *ngFor="let tag of product.tags">{{ tag.designation_fr }},
                </span></span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="product_d_info">
      <nav>
        <div class="nav nav-tabs mobiletabs" id="nav-tab" role="tablist">
          <button class="product_info_button nav-link active" id="nav-one-tab" data-bs-toggle="tab" data-bs-target="#nav-one"
            type="button" role="tab" aria-controls="nav-one" aria-selected="true">
            <h4 class="m-0">{{ product?.zone1 ? product?.zone1 : 'Description' }}</h4>
          </button>
          <button class="product_info_button nav-link" id="nav-two-tab" data-bs-toggle="tab" data-bs-target="#nav-two"
            type="button" role="tab" aria-controls="nav-two" aria-selected="false">
            <h4 class="m-0">{{ product?.zone2 ? product?.zone2 : 'Avis client' }}</h4>
          </button>
          <button class="product_info_button nav-link" id="nav-three-tab" data-bs-toggle="tab" data-bs-target="#nav-three"
            type="button" role="tab" aria-controls="nav-three" aria-selected="false">
            <h4 class="m-0">{{ product?.zone3 ? product?.zone3 : 'Valeurs nutritionnelles' }}</h4>
          </button>
          <button class="product_info_button nav-link" id="nav-four-tab" data-bs-toggle="tab" data-bs-target="#nav-four"
            type="button" role="tab" aria-controls="nav-four" aria-selected="false">
            <h4 class="m-0">{{ product?.zone4 ? product?.zone4 : 'Questions' }}</h4>
          </button>
        </div>
      </nav>
      <div class="tab-content" id="nav-tabContent">
        <div class="tab-pane fade show active pt-3" id="nav-one" role="tabpanel" aria-labelledby="nav-one-tab">
          <div class="product_info_content desc">
            <p [innerHTML]="product.description_fr" #containera></p>
          </div>
        </div>
        <div class="tab-pane fade pt-3" id="nav-two" role="tabpanel" aria-labelledby="nav-two-tab">
          <div class="row" *ngIf="product.reviews.length>0">
            <div class="col-md-3">
              <div class="text-center">
                <div class="ratings">
                  <span class="product-rating">{{average}}</span><span>/5</span>
                  <div class="stars">
                    <i class="fa fa-star" *ngIf="average>=1"></i>
                    <i class="fa fa-star" *ngIf="average>=2"></i>
                    <i class="fa fa-star" *ngIf="average>=3"></i>
                    <i class="fa fa-star" *ngIf="average>=4"></i>
                    <i class="fa fa-star" *ngIf="average>=5"></i>
                  </div>
                  <div class="rating-text">
                    <span>{{product.reviews.length}} avis sur ce produit</span>
                  </div>
                </div>
                <a class="btn btn-outline-success" href="#" data-bs-toggle="modal" [attr.data-bs-target]="'#rv'"
                  title="quick view"> Ajouter un avis</a>
              </div>
            </div>
            <div class="col-md-9">
              <ul class="list-unstyled mb-0"
                *ngFor="let review of product.reviews | paginate: { itemsPerPage: 4, currentPage: p }">
                <li class="p-2 border-bottom">
                  <div class="d-flex flex-row">
                    <div class="pt-1">
                      <p class="fw-bold mb-0">{{review.user.name}}</p>
                      <p class="mb-0 small text-muted">{{review.created_at |date}}</p>
                      <i class="fa fa-star" [ngClass]="{'star-color': review.stars>=1}"></i>
                      <i class="fa fa-star" [ngClass]="{'star-color': review.stars>=2}"></i>
                      <i class="fa fa-star" [ngClass]="{'star-color': review.stars>=3}"></i>
                      <i class="fa fa-star" [ngClass]="{'star-color': review.stars>=4}"></i>
                      <i class="fa fa-star" [ngClass]="{'star-color': review.stars>=5}"></i>
                      <p class="small text-muted">{{review.comment}}</p>
                    </div>
                  </div>

                </li>
              </ul>
              <pagination-controls (pageChange)="p = $event" class="my-pagination text-center"></pagination-controls>

            </div>
          </div>
          <div class="row" *ngIf="product.reviews.length==0">
            <div class="col-md-12">
              <div class="text-center">
                <div class="ratings p-0 ">
                  <div class="rating-text">
                    <span>Soyez le premier à rédiger un avis</span>
                  </div>
                </div>
                <a class="btn btn-outline-success" href="#" data-bs-toggle="modal" [attr.data-bs-target]="'#rv'"
                  title="quick view"> Ajouter un avis</a>
              </div>
            </div>

          </div>
        </div>
        <div class="tab-pane fade pt-3" id="nav-three" role="tabpanel" aria-labelledby="nav-three-tab">
          <p class="p-3" [innerHTML]="product?.nutrition_values"></p>
        </div>
        <div class="tab-pane fade pt-3" id="nav-four" role="tabpanel" aria-labelledby="nav-four-tab">
          <p class="p-3" [innerHTML]="product?.questions"></p>
        </div>
      </div>
    </div>
  </div>
  <!--product info end-->
  <!--product area start-->
  <section class="product_area related_products container">
    <div class="row">
      <div class="col-12">
        <div class="section_title">
          <div class="title_content">
            <h2>Produits Similaires</h2>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-lg-3 col-md-3 col-sm-6 col-6" *ngFor="let p of related_products">
        <app-product [product]="p" [key]="'_rel_'"></app-product>
      </div>
    </div>
  </section>
</div>















<div class="modal fade" id="rv" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
      <div class="modal_body">
        <div class="container">
          <div class="row">
            <form [formGroup]="login" (ngSubmit)="signin()">


              <div class="account_form login">
                <p *ngIf="!isUserAuthenticated">
                  <label>Adresse mail <span>*</span></label>
                  <input type="email" formControlName="email">
                  <small class="text-danger" *ngIf="login.get('email')?.errors?.['email']">Format
                    d'adresse mail non valide</small>
                </p>
                <p *ngIf="!isUserAuthenticated">
                  <label>Mot de passe <span>*</span></label>
                  <input type="password" formControlName="password">
                  <small class="text-danger" *ngIf="login.get('password')?.errors?.['minlength']">Le
                    mot de passe doit contenir au minimum 6 caractéres</small>
                  <span class="pt-1"> Vous n'avez pas de compte? <a href="/login" title="créer compte">s'inscrire
                    </a> </span>
                </p>
                <p class="text-center">
                  <label>Votre score <span>*</span></label>
                  <span *ngFor="let star of stars; let i = index" (click)="rate(i + 1)">
                    <ng-container *ngIf="star; else noStar"><i class="fs-16 fa fa-star star-color"></i></ng-container>
                    <ng-template #noStar><i class=" fs-16 fa fa-star"></i></ng-template>
                  </span>
                  {{rating}}/5
                </p>
                <textarea rows="4" [ngModelOptions]="{standalone: true}" placeholder="Ecrivez votre commentaire ici"
                  [(ngModel)]="reviewComment" class="form-control w100 "></textarea>
                <div class=" mt-2 d-flex justify-content-end ">
                  <button class="bg-green rvb m-0" type="submit"
                    [disabled]="!login.valid && !validateReview() && isUserAuthenticated || !isUserAuthenticated  && !validateReview() ">Envoyer
                    votre avis</button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
      <style>
        td {
          border-width: 1 !important;
        }

        body {
          background-color: red;
        }
      </style>
